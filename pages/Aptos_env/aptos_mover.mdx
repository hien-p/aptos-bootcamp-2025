
![](../assets/aptos_env/aptos_mover/move_prover_background.png)

# BÃ i viáº¿t nÃ y hÆ¡i advanced nhÆ°ng nÃ³ nÃªn cÃ³ trong section nÃ y  


import RedHighlight from '../../components/RedHighlight'


 <RedHighlight> ÄÃ³ lÃ  Aptos Mover.  </RedHighlight>

 > The Move prover is a formal verifier for smart contracts written in the Move language, which provides additional protection ğŸ›¡ for contract invariants and their behavior.


 Dá»‹ch ra lÃ  Move prover lÃ  má»™t cÃ´ng cá»¥ Ä‘á»ƒ **verify tÃ­nh Ä‘Ãºng Ä‘áº¯n cá»§a smart contract Ä‘Æ°á»£c viáº¿t báº±ng ngÃ´n ngá»¯ Move**. Move prover giÃºp Ä‘áº£m báº£o cÃ¡c smart contract hoáº¡t Ä‘á»™ng chÃ­nh xÃ¡c thÃ´ng qua viá»‡c chá»©ng minh toÃ¡n há»c tÃ­nh Ä‘Ãºng Ä‘áº¯n cá»§a code.

 Move prover hoáº¡t Ä‘á»™ng báº±ng cÃ¡ch tá»± Ä‘á»™ng verify ráº±ng code smart contract tuÃ¢n thá»§ cÃ¡c thuá»™c tÃ­nh nháº¥t Ä‘á»‹nh, vÃ­ dá»¥ nhÆ° khÃ´ng cho phÃ©p integer overflow hoáº·c underflow. NÃ³ cÅ©ng kiá»ƒm tra code khÃ´ng cÃ³ cÃ¡c lá»—i nhÆ° reentrancy vulnerabilities vÃ  lá»—i chia cho 0. Náº¿u Move prover phÃ¡t hiá»‡n báº¥t ká»³ vi pháº¡m nÃ o, nÃ³ sáº½ bÃ¡o cÃ¡o láº¡i cho developer Ä‘á»ƒ há» cÃ³ thá»ƒ sá»­a code trÆ°á»›c khi deploy.


 Move Prover tá»“n táº¡i Ä‘á»ƒ lÃ m cho cÃ¡c contract Ä‘Ã¡ng tin cáº­y hÆ¡n; nÃ³:

- Báº£o vá»‡ khá»‘i lÆ°á»£ng tÃ i sáº£n lá»›n Ä‘Æ°á»£c quáº£n lÃ½ bá»Ÿi blockchain Aptos khá»i cÃ¡c lá»—i smart contract
- ÄÃ¡p á»©ng cÃ¡c yÃªu cáº§u giÃ¡m sÃ¡t vÃ  tuÃ¢n thá»§ quy Ä‘á»‹nh
- Cho phÃ©p experts cÃ³ ná»n táº£ng toÃ¡n há»c, khÃ´ng nháº¥t thiáº¿t pháº£i cÃ³ background vá» software engineering, cÃ³ thá»ƒ hiá»ƒu Ä‘Æ°á»£c smart contract hoáº¡t Ä‘á»™ng nhÆ° tháº¿ nÃ o


```rust
module my_addrx::Example{
    struct Counter has key {
        value: u8,
    }

    public fun increment(a: address) acquires Counter {
        let c = borrow_global_mut<Counter>(a);
        c.value = c.value + 1;
    }

    spec increment {
        aborts_if !exists<Counter>(a);
        ensures global<Counter>(a).value == old(global<Counter>(a)).value + 1;
    }
}
```

Move Prover Ä‘Æ°á»£c gá»i thÃ´ng qua CLI cá»§a Aptos.

Gá»i Move Prover tá»« thÆ° má»¥c cáº§n kiá»ƒm tra hoáº·c báº±ng cÃ¡ch chá»‰ Ä‘á»‹nh Ä‘Æ°á»ng dáº«n thÃ´ng qua tham sá»‘ `--package-dir`:

- Kiá»ƒm tra code cá»§a package trong thÆ° má»¥c hiá»‡n táº¡i:

```bash
aptos move prove

// hoáº·c dÃ¹ng 

aptos move prove --package-dir <path>
```

Khi cháº¡y lá»‡nh `aptos move prove` cho code trÃªn, sáº½ xuáº¥t hiá»‡n lá»—i sau:

```rust
error: abort not covered by any of the `aborts_if` clauses
   â”‚  
 8 â”‚           c.value = c.value + 1;
   â”‚                             - abort happened here with execution failure
   Â·  
11 â”‚ â•­     spec increment {
12 â”‚ â”‚         aborts_if !exists&lt;Counter&gt;(a);
13 â”‚ â”‚         ensures global&lt;Counter&gt;(a).value == old(global&lt;Counter&gt;(a)).value + 1;
14 â”‚ â”‚     }
   â”‚ â•°â”€â”€â”€â”€â”€^
{
  "Error": "Move Prover failed: exiting with verification errors"
```

Move Prover Ä‘Ã£ táº¡o ra má»™t vÃ­ dá»¥ counter dáº«n Ä‘áº¿n trÃ n sá»‘ khi cá»™ng 1 vÃ o giÃ¡ trá»‹ 255 cá»§a kiá»ƒu `u8`. Lá»—i trÃ n sá»‘ nÃ y xáº£y ra khi function specification yÃªu cáº§u hÃ nh vi abort, nhÆ°ng Ä‘iá»u kiá»‡n khiáº¿n function abort láº¡i khÃ´ng Ä‘Æ°á»£c cover trong specification. Thá»±c táº¿, vá»›i `aborts_if !exists<Counter>(a)`, chÃºng ta chá»‰ cover trÆ°á»ng há»£p abort do resource khÃ´ng tá»“n táº¡i, mÃ  khÃ´ng cover trÆ°á»ng há»£p abort do trÃ n sá»‘ trong phÃ©p tÃ­nh.

MÃ¬nh sáº½ sá»­a sau: 
```rust
spec increment {
    aborts_if global<Counter>(a).value == 255;
    ...
}
```

Vá»›i Ä‘iá»u kiá»‡n nÃ y, Move Prover sáº½ cháº¡y thÃ nh cÃ´ng mÃ  khÃ´ng gáº·p lá»—i nÃ o

# Kiáº¿n trÃºc cá»§a Move prover 

Kiáº¿n trÃºc tá»•ng thá»ƒ cá»§a Move Prover Ä‘Æ°á»£c thá»ƒ hiá»‡n trong sÆ¡ Ä‘á»“ sau: 

![](../assets/aptos_env/aptos_mover/prover_architecture.png)


CÃ¡ch mÃ  Move prover hoáº¡t Ä‘á»™ng dá»±a trÃªn kiáº¿n trÃºc trÃªn sáº½ lÃ  
* Step 1: Nháº­n file code Move lÃ m Ä‘áº§u vÃ o
* Step 2: Move parser sáº½ láº¥y specification( Äáº·c táº£) tá»« code move 
* Step 3: Move compiler sáº½ convert sang dáº¡ng bytecode rá»“i káº¿t há»£p giá»¯a Ä‘áº·c táº£(specification) vÃ  bytecode thÃ nh Prover Object Model. 
    * Chuyá»ƒn Ä‘á»•i thÃ nh ngÃ´n ngá»¯ trung gian Boogie
    * Boogie thá»±c hiá»‡n "verification condition generation"


* Step 4: QuÃ¡ trÃ¬nh xÃ¡c minh:
    * Sá»­ dá»¥ng Z3 (SMT solver cá»§a Microsoft) Ä‘á»ƒ kiá»ƒm tra cÃ´ng thá»©c
    * Náº¿u cÃ´ng thá»©c khÃ´ng thá»a mÃ£n -> Ä‘áº·c táº£ Ä‘Ãºng
    * Náº¿u thá»a mÃ£n -> táº¡o mÃ´ hÃ¬nh vÃ  bÃ¡o cÃ¡o lá»—i

Báº¡n cÃ³ thá»ƒ Ä‘á»c thÃªm á»Ÿ Ä‘Ã¢y: https://www.numencyber.com/security-analysis-of-the-move-language-game-changer-of-smart-contracts/ 